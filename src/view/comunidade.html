<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comunidade - Conecta+</title>
    <link rel="stylesheet" href="/css/comunidade.css">
</head>

<body>
    <!-- CABEÇALHO -->
    <header class="cabecalho">
        <div class="logo">
            <a href="../view/inicio2.html">
                <img src="/imgs/banner-logo/CONECTA+.png" alt="Logo Conecta+">
            </a>
        </div>

        <nav class="menu">
            <a href="../view/inicio2.html">Início</a>
            <a href="../view/meuPerfil.html">Meu Perfil</a>
            <a href="../view/sobreNos.html">Sobre Nós</a>
        </nav>
    </header>

    <!-- SEÇÃO DOS RELATOS -->
    <section class="secao-relatos">
        <h2>RELATOS DA COMUNIDADE</h2>

        <!-- DROPDOWN -->
        <div class="dropdown">
            <button class="dropdown-button" onclick="toggleDropdown()">Tipos de conteúdo</button>
            <ul class="dropdown-menu" id="dropdownMenu">
                <li><a href="#" data-categoria="Todos">Todos</a></li>
                <li><a href="#" data-categoria="Denúncia">Denúncia</a></li>
                <li><a href="#" data-categoria="Perigo">Perigo</a></li>
                <li><a href="#" data-categoria="Sobre o Bairro">Sobre o Bairro</a></li>
            </ul>
        </div>


        <!-- CARDS DINÂMICOS -->
        <div class="cards-container" id="cards-container"></div>

        <!-- BOTÃO ENVIAR RELATO -->
        <div class="enviar-relato">
            <a href="../view/publicarRelato.html">ENVIAR RELATO</a>
        </div>
    </section>

    <!-- RODAPÉ -->
    <footer class="rodape">
        <div class="rodape-conteudo">
            <p><strong>Endereço:</strong> SC-401, 3730 - Saco Grande, Florianópolis - SC, 88032-005</p>
            <p><strong>Telefone:</strong> (48) 3239-5801</p>

            <div class="redes-sociais">
                <a href="https://wa.me/554832395801" target="_blank">
                    <img src="/imgs/icons/whats.svg" alt="WhatsApp">
                </a>
                <a href="https://facebook.com" target="_blank">
                    <img src="/imgs/icons/face.svg" alt="Facebook">
                </a>
                <a href="https://instagram.com" target="_blank">
                    <img src="/imgs/icons/insta.svg" alt="Instagram">
                </a>
            </div>

            <p><strong>© 2025 Conecta+. Todos os direitos reservados.</strong></p>
        </div>
    </footer>



    <!-- SCRIPT -->
    <script>
        function toggleDropdown() {
            document.getElementById("dropdownMenu").classList.toggle("show");
        }

        // Fecha o dropdown ao clicar fora
        window.addEventListener("click", (e) => {
            const btn = e.target.closest(".dropdown-button");
            if (!btn) document.getElementById("dropdownMenu").classList.remove("show");
        });

        const container = document.getElementById("cards-container");
        let todosRelatos = [];

        function renderCards(relatos) {
            if (!relatos || relatos.length === 0) {
                container.innerHTML = "<p>Nenhum relato encontrado.</p>";
                return;
            }

            const html = relatos.map(relato => {
                let midias = "";

                if (relato.foto) {
                    midias += `<img src="data:image/jpeg;base64,${relato.foto}" alt="Foto do relato">`;
                }
                if (relato.video) {
                    midias += `
          <video controls width="300">
            <source src="data:video/mp4;base64,${relato.video}" type="video/mp4">
            Seu navegador não suporta vídeo.
          </video>
        `;
                }

                return `
        <div class="card-relato">
          <h4>${relato.nome || "Anônimo"}</h4>
          <small><strong>${relato.categoria}</strong></small>
          <p>${relato.descricao}</p>
          ${midias}
          <div class="acoes-relato">
            <button>Curtir</button>
            <button>Comentar</button>
            <button>Compartilhar</button>
          </div>
        </div>
      `;
            }).join("");

            container.innerHTML = html;
        }

        // Busca inicial dos relatos
        async function carregarRelatos() {
            try {
                const res = await fetch("http://localhost:3000/relatoListar");
                const data = await res.json();
                todosRelatos = (data && data.data) ? data.data : [];
                renderCards(todosRelatos);
            } catch (err) {
                console.error("Erro ao carregar relatos:", err);
                container.innerHTML = "<p>Erro ao carregar relatos.</p>";
            }
        }

        // Filtro por categoria
        document.getElementById("dropdownMenu").addEventListener("click", (e) => {
            const link = e.target.closest("a[data-categoria]");
            if (!link) return;

            e.preventDefault(); // Evita navegação #
            const categoria = link.getAttribute("data-categoria");

            if (categoria === "Todos") {
                renderCards(todosRelatos);
            } else {
                const filtrados = todosRelatos.filter(r => r.categoria === categoria);
                renderCards(filtrados);
            }

            // Fecha o dropdown após selecionar
            document.getElementById("dropdownMenu").classList.remove("show");
        });

        // Iniciar
        carregarRelatos();
    </script>

</body>

</html>